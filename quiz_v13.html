
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quiz</title>
</head>
<body>
  <h1>Pergunta 1</h1>
  <button onclick="localStorage.setItem('quizLastStep', 1)">Opção 1</button>
  <button onclick="localStorage.setItem('quizLastStep', 1)">Opção 2</button>

  <h1>Pergunta 2</h1>
  <button onclick="localStorage.setItem('quizLastStep', 2)">Opção A</button>
  <button onclick="localStorage.setItem('quizLastStep', 2)">Opção B</button>

  <script>
    const sessionId = localStorage.getItem("quizSessionId") || (() => {
      const newId = 'sessao_' + Date.now() + '_' + Math.floor(Math.random() * 100000);
      localStorage.setItem("quizSessionId", newId);
      return newId;
    })();

    function registrarEvento(tipo, detalhes) {
      fetch('https://quiz-backend-production-a8c0.up.railway.app/registrar-clique', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        keepalive: true,
        body: JSON.stringify({
          tipo,
          detalhes,
          timestamp: Date.now(),
          session: sessionId
        })
      });
    }

    function registrarClique(identificador) {
      registrarEvento("clique", { id: identificador });
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('button').forEach(botao => {
        botao.addEventListener('click', () => {
          registrarClique(botao.innerText);
        });
      });
    });

    window.addEventListener("beforeunload", () => {
      const ultimaEtapa = localStorage.getItem("quizLastStep");
      registrarEvento("abandonou_quiz", { ultimaEtapa });
    });
  </script>
</body>
</html>
